---
title: "Expert advice from experts"
author:
- familyname: Curie
  othernames: Marie
  address: University of Paris
  email: mcurie.notreal@gmail.com
  correspondingauthor: true
  qualifications: Nobel Prize, PhD
- familyname: Curie
  othernames: Pierre
  address: University of Paris
  qualifications: Nobel Prize, PhD
department: Department of\newline Econometrics &\newline Business Statistics
organization: Acme Corporation
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  MonashEBSTemplates::report:
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache=TRUE, messages=FALSE, warning=FALSE)
# Make sure you have the latest versions of rmarkdown and bookdown installed
library(dplyr)
library(ggplot2)
library(tidyverse)
```


```{r data}
stocks_ori <- read.csv("stocks.csv")
#nrow(stocks)
#head(stocks)
stocks <- na.omit(stocks_ori)%>%
  rename(intra_day=Market.cap..intra.day.,
         ent_value=Enterprise.value,
         trail_pe=Trailing.P.E,
         for_pe=Forward.P.E,
         peg=PEG.ratio..5.yr.expected.,
         ttm=Price.sales..ttm.,
         mrq=Price.book..mrq.,
         rev=Enterprise.value.revenue,
         ebitda=Enterprise.value.EBITDA,
         tot_risk = Total.ESG.risk.score,
         envir_risk = Environmental.Risk.Score,
         social_risk = Social.Risk.Score,
         gover_risk = Governance.Risk.Score)
  
#stocks <- na.omit(stocks)
#nrow(stocks)
#glimpse(stocks)
```

147 variables with 102 having the missing value

```{r}
summary(stocks)
```

## Description of the variables related to the value of stocks:
- Market capitalization refers to how much a company is worth as determined by the stock market. It is defined as the total market value of all outstanding shares. To calculate a company's market cap, multiply the number of outstanding shares by the current market value of one share. Companies are typically divided according to market capitalization: large-cap (\$10 billion or more), mid-cap (\$2 billion to \$10 billion), and small-cap ($300 million to \$2 billion). Enterprise value includes in its calculation the market capitalization of a company but also short-term and long-term debt as well as any cash on the company's balance sheet. Enterprise value is used as the basis for many financial ratios that measure the performance of a company.
- Enterprise value (EV) is a measure of a company's total value, often used as a more comprehensive alternative to equity market capitalization.
- Trailing P/E is calculated by dividing the current market value, or share price, by the earnings per share over the previous 12 months.
- The forward P/E ratio estimates a company's likely earnings per share for the next 12 months.
- The PEG ratio enhances the P/E ratio by adding in expected earnings growth into the calculation. The PEG ratio is considered to be an indicator of a stock's true value, and similar to the P/E ratio, a *lower PEG may indicate that a stock is undervalued*.
- The P/S ratio is a key analysis and valuation tool that shows *how much investors are willing to pay per dollar of sales for a stock.* The P/S ratio is typically calculated by dividing the stock price by the underlying company's sales per share.A low ratio could imply the stock is undervalued while a ratio that is higher-than-average could indicate that the stock is overvalued.
- The P/B ratio measures the market's valuation of a company relative to its book value.*The market value of equity is typically higher than the book value of a company.* P/B ratio is used by value investors to identify potential investments. P/B ratios under 1 are typically considered solid investments.
- The enterprise value-to-revenue (EV/R) multiple helps compares a company’s revenues to its enterprise value. *The lower the better, in that, a lower EV/R multiple signals a company is undervalued.*
- The enterprise value to earnings before interest, taxes, depreciation, and amortization ratio (EV/EBITDA) compares the value of a company—debt included—to the company’s cash earnings less non-cash expenses. The EV/EBITDA metric is a popular valuation tool that helps investors compare companies in order to make an investment decision. EV calculates a company's total value or assessed worth, while EBITDA measures a company's overall financial performance and profitability. Typically, when evaluating a company, *an EV/EBITDA value below 10 is seen as healthy*. It's best to use the EV/EBITDA metric when comparing companies within the same industry or sector.

```{r, eval=FALSE}
stocks %>% 
  dplyr::filter(ebitda<10) %>% 
  ggplot(aes(ebitda, ebitda)) + 
  geom_boxplot() + 
  facet_wrap(~Industry)
```

### Considering outliers
- outliers in `intra_day` and `ent_value`: MSFT & AAPL
- outliers in `trail_pe`: TSLA
- outliers in `for_pe`: ILMN & TSLA
- outliers in `peg`: DIS, VZ, KO, MMM, CVX, PCAR, CAT, XOM
- outliers in `ttm`: ILMN, V
- outliers in `mrq`: TSLA
- outliers in `rev`: ILMN, V
- outliers in `ebitda`: INTU, ILMN, TSLA, NKE

```{r}
df <- issuer[!(issuer$Symbol %in% c("MSFT", "AAPL", "TSLA", "ILMN", "DIS", "VZ", "KO", "MMM", "CVX", "PCAR", "CAT", "XOM", "V", "INTU", "NKE")),]
```



## Value Analysis
```{r value}
issuer<-stocks%>%
  select(Symbol,intra_day,ent_value,trail_pe,for_pe,peg,ttm,mrq,rev,ebitda)

pca_value<-issuer%>%
  select(intra_day,ent_value,trail_pe,for_pe,peg,ttm,mrq,rev,ebitda)%>%
  prcomp(scale.=TRUE)
rownames(pca_value$x)<-pull(issuer,Symbol)
biplot(pca_value, expand=10,xlim=c(-0.2,0.2),ylim=c(-0.01,0.05),cex=0.7)
```

```{r, eval=FALSE}
stocks %>% filter(Industry == "Technology")
```

## Value analysis(All)

```{r}
all_value <- stocks %>% 
  select(intra_day:ebitda) %>%
  prcomp(scale. = TRUE)
summary(all_value)
rownames(all_value$x) <- pull(stocks, Symbol)
biplot(all_value)
#all_value$rotation
screeplot(all_value, type = "lines")
```




## Risk 
```{r first_check, eval=FALSE}
d <- apply(cbind(stocks$Environmental.Risk.Score, stocks$Social.Risk.Score, stocks$Governance.Risk.Score), 1, sum)
all(stocks$Total.ESG.risk.score == d)
```

```{r risk data, eval=FALSE}
# checking if total esg risk score = environmrnt + social + government 
stocks_tesg <- stocks[stocks[,15] == d,]
d <- apply(cbind(stocks_tesg$Environmental.Risk.Score, stocks_tesg$Social.Risk.Score, stocks_tesg$Governance.Risk.Score), 1, sum)
all(stocks_tesg$Total.ESG.risk.score == d, na.rm = TRUE)
stocks_risk <- stocks_tesg %>% select(Symbol, Environmental.Risk.Score, Social.Risk.Score, Governance.Risk.Score)
```

```{r pca_risk, eval=FALSE}
pca_risk <- stocks_risk %>% select_if(is.numeric) %>% prcomp(scale. = TRUE)
rownames(pca_risk$x) <- pull(stocks_risk, Symbol)
biplot(pca_risk, xlim=c(-0.4,0.4), cex=0.7)
```


# Introduction